# ユーザー認証機能 要件定義

## REQ-001: ログイン機能

### 概要
ユーザーがメールアドレスとパスワードを使用してシステムにログインできる機能を提供する。

### 機能要件
1. ユーザーはメールアドレスとパスワードを入力してログインできる
2. パスワードは8文字以上の英数字を含む必要がある
3. ログインに3回失敗した場合、アカウントを30分間ロックする
4. ログイン成功時、セッショントークンを発行する
5. セッションの有効期限は24時間とする

### 非機能要件
1. ログイン処理は3秒以内に完了すること
2. パスワードはハッシュ化して保存すること
3. ログイン試行はログに記録すること

### 画面項目
| 項目名 | 必須 | 型 | 制約 |
|--------|------|-----|------|
| メールアドレス | ○ | String | 有効なメール形式 |
| パスワード | ○ | String | 8文字以上、英数字含む |

## REQ-002: パスワードリセット機能

### 概要
ユーザーがパスワードを忘れた場合に、メールアドレスを使用してパスワードをリセットできる機能を提供する。

### 機能要件
1. ユーザーはメールアドレスを入力してリセットリンクを要求できる
2. リセットリンクの有効期限は1時間とする
3. リセットリンクは1回のみ使用可能とする
4. 新しいパスワードは以前のパスワードと異なる必要がある

### 非機能要件
1. リセットメールは5分以内に送信されること
2. リセットリンクはトークンベースで生成すること

## REQ-003: 二段階認証機能

### 概要
セキュリティ強化のため、ログイン時に二段階認証を有効化できる機能を提供する。

### 機能要件
1. ユーザーは設定画面で二段階認証を有効化できる
2. 認証方式はTOTPを使用する
3. バックアップコードを10個生成する
4. 二段階認証コードは6桁の数字とする
5. コードの有効期限は30秒とする

### 非機能要件
1. バックアップコードは暗号化して保存すること
2. 認証失敗時は適切なエラーメッセージを表示すること
